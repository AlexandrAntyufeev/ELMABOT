
import os
from telegram import Update, ReplyKeyboardMarkup, KeyboardButton, InputFile
from telegram.ext import ApplicationBuilder, CommandHandler, MessageHandler, filters, ContextTypes

TELEGRAM_BOT_TOKEN = os.getenv("TELEGRAM_BOT_TOKEN")

BACK = "‚¨ÖÔ∏è –ù–∞–∑–∞–¥"

USER_STATE = {}

# –û—Ç–≤–µ—Ç—ã —Å –∫—Ä–∞—Ç–∫–æ–π —Å–ø—Ä–∞–≤–∫–æ–π –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
RESPONSES = {
"üìë –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏—è/–ü–°–¶: üÜï –°–æ–∑–¥–∞–Ω–∏–µ": {
        "text": "–ù–∞–∂–º–∏—Ç–µ +–î–æ–ø. —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (*), –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Ñ–∞–π–ª, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º—É –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ.",
        "image": "psc_card.png"
    },
    "üìã –°–æ–≥–ª–∞—à–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –¥–æ–≥–æ–≤–æ—Ä–∞: üÜï –°–æ–∑–¥–∞–Ω–∏–µ": {
        "text": "–ù–∞–∂–º–∏—Ç–µ +–°–æ–≥–ª–∞—à–µ–Ω–∏–µ. –£–∫–∞–∂–∏—Ç–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞, —Ç–∏–ø —Å–æ–≥–ª–∞—à–µ–Ω–∏—è, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (*) –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ.",
        "image": "agreement_separate.png"
    },
    "üè¢ –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç: üÜï –°–æ–∑–¥–∞–Ω–∏–µ": {
        "text": "–ù–∞–∂–º–∏—Ç–µ +–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç. –£–∫–∞–∂–∏—Ç–µ –ò–ù–ù –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (*), —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ.",
        "image": "contractor_create.png"
    },
    "üìÑ –î–æ–≥–æ–≤–æ—Ä: üÜï –°–æ–∑–¥–∞–Ω–∏–µ": {
        "text": "–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É +–î–æ–≥–æ–≤–æ—Ä. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (*), –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ.",
        "image": "dogovor_create.png"
    },
"üìÑ –î–æ–≥–æ–≤–æ—Ä:  –ö–∞—Ä—Ç–æ—á–∫–∞ –¥–æ–≥–æ–≤–æ—Ä–∞": {
    "text": "–ü—Ä–∏ –≤—ã–±–æ—Ä–µ –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–æ–º –Ω–µ—Ç–∏–ø–æ–≤–æ–π —Ñ–æ—Ä–º—ã –¥–æ–≥–æ–≤–æ—Ä–∞ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è —à–∞–±–ª–æ–Ω –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –¥–æ–≥–æ–≤–æ—Ä–∞. –î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã —Å–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã. –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑–¥–µ–ª—è–µ—Ç—Å—è –Ω–∞ –¥–≤–∞ —ç—Ç–∞–ø–∞ ‚Äî –†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –∏ –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ. –ù–∞ —ç—Ç–∞–ø–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—è —ç–∫—Å–ø–µ—Ä—Ç—ã –ø–æ–ª—É—á–∞—é—Ç –∑–∞–¥–∞—á–∏ —Å —Ü–µ–ª—å—é –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è —Å –ø—Ä–æ–µ–∫—Ç–æ–º –¥–æ–≥–æ–≤–æ—Ä–∞ –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ —Ä–∞–∑–Ω–æ–≥–ª–∞—Å–∏–π (–µ—Å–ª–∏ –µ—Å—Ç—å –∑–∞–º–µ—á–∞–Ω–∏—è). –ò—Å–ø–æ–ª–Ω–µ–Ω–æ ‚Äì –∫–Ω–æ–ø–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ —ç–∫—Å–ø–µ—Ä—Ç –æ–∑–Ω–∞–∫–æ–º–∏–ª—Å—è —Å –¥–æ–∫—É–º–µ–Ω—Ç–æ–º –≤–æ –≤–∫–ª–∞–¥–∫–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Å—Ç–∞–≤–∏–ª –∑–∞–º–µ—á–∞–Ω–∏—è –≤–æ –≤–∫–ª–∞–¥–∫–µ ¬´–ó–∞–º–µ—á–∞–Ω–∏—è –ø–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—é¬ª.",
    "image": "agreement_review.png"
},

"üìÑ –î–æ–≥–æ–≤–æ—Ä: ‚úÖ –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ": {
    "text": "–î–ª—è —Ç–∏–ø–æ–≤–æ–π —Ñ–æ—Ä–º—ã –¥–æ–≥–æ–≤–æ—Ä–∞ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —à–∞–±–ª–æ–Ω –¥–æ–≥–æ–≤–æ—Ä–∞ –∏ –≤—ã–±–∏—Ä–∞–µ—Ç —à–∞–±–ª–æ–Ω –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–º–∏ –∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–º–∏ –º–∞—Ä—à—Ä—É—Ç–∞–º–∏ –≤ —Å–∏—Å—Ç–µ–º–µ. –£ –≤—Å–µ—Ö —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ –∑–∞–¥–∞—á–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –∏–º–µ—é—Ç –æ–±—â–∏–π –≤–∏–¥. –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ/–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º ‚Äì –¥–∞–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç —Å—Ö–æ–∂—É—é —Ñ—É–Ω–∫—Ü–∏—é, –æ—Ç–ª–∏—á–∏–µ —Ç–æ–ª—å–∫–æ –≤ —Ç–æ–º —á—Ç–æ –ø—Ä–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–∏ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º —Å–∏—Å—Ç–µ–º–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ—Ç–º–µ—á–µ–Ω –≤ –ª–∏—Å—Ç–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è. –û–±–µ —ç—Ç–∏ –∫–Ω–æ–ø–∫–∏ –æ–∑–Ω–∞—á–∞—é—Ç –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è. –ù–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ ‚Äì –¥–∞–Ω–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –ø–æ–ø—Ä–æ—Å–∏—Ç –∑–∞–ø–æ–ª–Ω–∏—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∏ –Ω–∞–∑–Ω–∞—á–∏—Ç –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä—É –∑–∞–¥–∞—á—É –ø–æ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–µ.",
    "image": "agreement_approval.png"
},

"üìÑ –î–æ–≥–æ–≤–æ—Ä: üìù –†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ": {
    "text": "–ü—Ä–∏ –≤—ã–±–æ—Ä–µ –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–æ–º –Ω–µ—Ç–∏–ø–æ–≤–æ–π —Ñ–æ—Ä–º—ã –¥–æ–≥–æ–≤–æ—Ä–∞ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è —à–∞–±–ª–æ–Ω –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –¥–æ–≥–æ–≤–æ—Ä–∞. –î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã —Å–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã. –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑–¥–µ–ª—è–µ—Ç—Å—è –Ω–∞ –¥–≤–∞ —ç—Ç–∞–ø–∞ ‚Äî –†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –∏ –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ. –ù–∞ —ç—Ç–∞–ø–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—è —ç–∫—Å–ø–µ—Ä—Ç—ã –ø–æ–ª—É—á–∞—é—Ç –∑–∞–¥–∞—á–∏ —Å —Ü–µ–ª—å—é –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è —Å –ø—Ä–æ–µ–∫—Ç–æ–º –¥–æ–≥–æ–≤–æ—Ä–∞ –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ —Ä–∞–∑–Ω–æ–≥–ª–∞—Å–∏–π (–µ—Å–ª–∏ –µ—Å—Ç—å –∑–∞–º–µ—á–∞–Ω–∏—è). –ò—Å–ø–æ–ª–Ω–µ–Ω–æ ‚Äì –∫–Ω–æ–ø–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ —ç–∫—Å–ø–µ—Ä—Ç –æ–∑–Ω–∞–∫–æ–º–∏–ª—Å—è —Å –¥–æ–∫—É–º–µ–Ω—Ç–æ–º –≤–æ –≤–∫–ª–∞–¥–∫–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Å—Ç–∞–≤–∏–ª –∑–∞–º–µ—á–∞–Ω–∏—è –≤–æ –≤–∫–ª–∞–¥–∫–µ ¬´–ó–∞–º–µ—á–∞–Ω–∏—è –ø–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—é¬ª.",
    "image": "agreement_review.png"
},

"üìÑ –î–æ–≥–æ–≤–æ—Ä: –ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ": {
    "text": "–ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –ø–æ–ª—É—á–µ–Ω—ã –≤—Å–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –æ—Ç –≤—Å–µ—Ö –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ—Ç–¥–µ–ª–æ–≤ (—É—á–∏—Ç—ã–≤–∞—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏), –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è –∑–∞–¥–∞—á–∞ –Ω–∞ –ø–æ–¥–ø–∏—Å–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ñ–æ—Ä–º—ã –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è: –†—É—á–Ω–æ–π —Å–ø–æ—Å–æ–± –ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä—É –ø–æ—Å—Ç—É–ø–∞–µ—Ç –∑–∞–¥–∞—á–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–±—Ä–∞—Ç—å –ø–µ—Ä–≤—É—é —Å—Ç–æ—Ä–æ–Ω—É ¬´–ù–∞—à–∞ –∫–æ–º–ø–∞–Ω–∏—è¬ª –∏–ª–∏ ¬´–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç¬ª. –û—Ç –¥–∞–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –±—É–¥–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å—Å—è –ø–æ—Ä—è–¥–æ–∫ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∑–∞–¥–∞—á. –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –ø–æ—Ä—è–¥–∫–∞ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è –Ω–∞–∑–Ω–∞—á–∞—é—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–¥–∞—á–∏ –Ω–∞ –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞. –ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ –≤ –Ω–∞—à–µ–π –∫–æ–º–ø–∞–Ω–∏–∏ –∑–∞—Ç–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ø–æ–¥–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—É (—Ç–∞–∫–∂–µ —Å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º —Å–æ–ø—Ä–æ–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø–∏—Å—å–º–∞) –∏ –≤ –æ–±—Ä–∞—Ç–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.",
    "image": "sign_order.png"
},

"üìÑ –î–æ–≥–æ–≤–æ—Ä: –ü–æ–¥–ø–∏—Å–∞–Ω–æ —Å –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω": {
    "text": "–ï—Å–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç —É–∂–µ –ø–æ–¥–ø–∏—Å–∞–Ω —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞, —Ç–æ –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä –ø–æ–ª—É—á–∏—Ç –∑–∞–¥–∞—á—É –ø–æ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—é —Å –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω.",
    "image": "signed_contract.png"
},

"üìÑ –î–æ–≥–æ–≤–æ—Ä:  –ö–∞—Ä—Ç–æ—á–∫–∞ –¥–æ–≥–æ–≤–æ—Ä–∞: –ö–Ω–æ–ø–∫–∏ –∫–∞—Ä—Ç–æ—á–∫–∏: –ó–∞–ø—Ä–æ—Å–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é": {
    "text": "–ó–∞–ø—Ä–æ—Å–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é ‚Äì –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç—É –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–ø–∏—Å–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É –∏ –±—É–¥–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –∑–∞–¥–∞—á–∞ –≤ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –æ—Ç–¥–µ–ª –¥–ª—è —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–æ–º–µ—Ä–∞ –¥–æ—Å—Ä–æ—á–Ω–æ. –Æ—Ä–∏—Å—Ç —É–≤–∏–¥–∏—Ç –ø—Ä–∏—á–∏–Ω—É –¥–∞–Ω–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∏ –ø—Ä–∏—Å–≤–æ–∏—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –Ω–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç—É –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω–∏—Ç –∑–∞—è–≤–∫—É.",
    "image": "registration_request.png"
},

"üìÑ –î–æ–≥–æ–≤–æ—Ä:  –ö–∞—Ä—Ç–æ—á–∫–∞ –¥–æ–≥–æ–≤–æ—Ä–∞: –ö–Ω–æ–ø–∫–∏ –∫–∞—Ä—Ç–æ—á–∫–∏: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ": {
    "text": "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ ‚Äì –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –Ω–µ—Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –±–µ–∑ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è, –¥–∞–Ω–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –¥–æ–≥–æ–≤–æ—Ä–∞ –≤ —Å—Ç–∞—Ç—É—Å ‚Äú–Ω–∞ –ø–æ–¥–ø–∏—Å–∞–Ω–∏–∏‚Äù.",
    "image": "partial_edit.png"
},

"üìÑ –î–æ–≥–æ–≤–æ—Ä:  –ö–∞—Ä—Ç–æ—á–∫–∞ –¥–æ–≥–æ–≤–æ—Ä–∞: –ö–Ω–æ–ø–∫–∏ –∫–∞—Ä—Ç–æ—á–∫–∏: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –ø—Ä–µ—Ä–≤–∞—Ç—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ": {
    "text": "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –ø—Ä–µ—Ä–≤–∞—Ç—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ ‚Äì –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞, –¥–∞–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –ø—Ä–µ—Ä–≤—ë—Ç –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞ –∏ –≤–µ—Ä–Ω–µ—Ç –¥–æ–≥–æ–≤–æ—Ä –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä—É –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Å—Ç–∞—Ä—Ç—É –ø—Ä–æ—Ü–µ—Å—Å–∞).",
    "image": "edit_and_interrupt_approval.png"
},
}

# –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
MAIN_MENU = list(set(k.split(":")[0] for k in RESPONSES.keys()))

# –ù–∞–≤–∏–≥–∞—Ü–∏—è
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    USER_STATE[update.effective_user.id] = "MAIN"
    keyboard = [[KeyboardButton(item)] for item in MAIN_MENU]
    await update.message.reply_text("–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª:", reply_markup=ReplyKeyboardMarkup(keyboard, resize_keyboard=True))

async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    text = update.message.text

    if text == BACK:
        USER_STATE[user_id] = "MAIN"
        keyboard = [[KeyboardButton(item)] for item in MAIN_MENU]
        await update.message.reply_text("–í–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:", reply_markup=ReplyKeyboardMarkup(keyboard, resize_keyboard=True))
        return

    current_state = USER_STATE.get(user_id, "MAIN")

    # –ü–µ—Ä–≤–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –≤–≥–ª—É–±—å
    if current_state == "MAIN" and any(k.startswith(text) for k in RESPONSES):
        USER_STATE[user_id] = text
        options = [k.split(":")[1].strip() for k in RESPONSES if k.startswith(text)]
        keyboard = [[KeyboardButton(option)] for option in options] + [[KeyboardButton(BACK)]]
        await update.message.reply_text(f"–†–∞–∑–¥–µ–ª: {text}. –í—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç:", reply_markup=ReplyKeyboardMarkup(keyboard, resize_keyboard=True))
        return

    # –û—Ç–≤–µ—Ç –ø–æ —Å–ø—Ä–∞–≤–∫–µ
    full_key = f"{current_state}: {text}"
    if full_key in RESPONSES:
        resp = RESPONSES[full_key]
        await update.message.reply_text(resp["text"])
        try:
            with open(f"images/{resp['image']}", "rb") as img:
                await update.message.reply_photo(photo=InputFile(img))
        except Exception:
            await update.message.reply_text("‚ö†Ô∏è –ö–∞—Ä—Ç–∏–Ω–∫–∞ –ø–æ–∫–∞ –Ω–µ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∞.")
        return

    await update.message.reply_text("–ò–∑–≤–∏–Ω–∏—Ç–µ, —è –Ω–µ –ø–æ–Ω—è–ª. –ù–∞–∂–º–∏—Ç–µ /start –¥–ª—è –Ω–∞—á–∞–ª–∞.")

if __name__ == '__main__':
    app = ApplicationBuilder().token(TELEGRAM_BOT_TOKEN).build()
    app.add_handler(CommandHandler("start", start))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))
    app.run_polling()
